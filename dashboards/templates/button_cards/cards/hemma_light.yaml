hemma_light:
  template:
    - hemma_entity

  show_last_changed: false

  state_display: >
    [[[
      const expand = (eid, seen = new Set()) => {
        if (!eid || seen.has(eid)) return [];
        seen.add(eid);

        const st = states[eid];
        if (!st) return [];

        const members = st.attributes?.entity_id;
        if (Array.isArray(members)) {
          return members.flatMap(m => expand(m, seen));
        }

        return [eid];
      };

      const root = entity?.entity_id;
      const all = [...new Set(expand(root))].filter(eid => eid.startsWith("light."));
      const onCount = all.filter(eid => states[eid]?.state === "on").length;

      return onCount > 0 ? `${onCount} On` : "Off";
    ]]]

  tap_action:
    action: more-info

  hold_action:
    action: toggle
