homio_plex:
  template:
    - homio_entity
  show_last_changed: false
  show_entity_picture: false
  show_icon: false
  
  visibility:
    - condition: state
      entity: '[[[ return entity.entity_id ]]]'
      state: "playing"
    - condition: state
      entity: '[[[ return entity.entity_id ]]]'
      state: "paused"

  state_display: |
    [[[
      const s = entity?.state || '';
      const title = entity?.attributes?.full_title || '';
      if (s === 'playing') return `Playing - ${title || 'Unknown Title'}`;
      if (s === 'paused')  return `Paused - ${title || 'Unknown Title'}`;
      return s ? s.charAt(0).toUpperCase() + s.slice(1) : '';
    ]]]
  tap_action:
    action: more-info
  hold_action:
    action: more-info

  name: |
    [[[
      const a = entity?.attributes || {};
      return a.user || a.user_friendly_name || a.username || "";
    ]]]

  styles:
    grid:
      - grid-template-areas: '"n icon_right" "s icon_right"'
      - grid-template-columns: 1fr auto
      - grid-template-rows: min-content min-content
      - align-items: start
      - column-gap: 0px

    card:
      - background-size: cover
      - background-position: center
      - background-image: |
          [[[
            const s = entity?.state;
            if (s !== 'playing' && s !== 'paused') return 'none';
            const base = window.location.origin;
            const img = entity?.attributes?.image_url || entity?.attributes?.art_url || '/local/images/plex.jpg';
            const url = img?.startsWith('http') ? img : `${base}${img}`;
            return `linear-gradient(rgba(70,70,70,0.7), rgba(70,70,70,0.7)), url('${url}')`;
          ]]]

    name:
      - grid-area: n
      - color: var(--primary-text-color)
      - font-weight: 600
      - text-shadow: 0 0 4px rgba(0, 0, 0, 0.2)
      - align-self: end
      - z-index: 2
      - white-space: nowrap
      - overflow: hidden
      - text-overflow: ellipsis

    state:
      - grid-area: s
      - color: var(--primary-text-color)
      - font-size: 14px
      - text-shadow: 0 0 2px rgba(0, 0, 0, 0.15)
      - align-self: start
      - z-index: 2
      - white-space: nowrap
      - overflow: hidden
      - text-overflow: ellipsis

    custom_fields:
      icon_right:
        - grid-area: icon_right
        - justify-self: end
        - align-self: center
        - margin-right: -8px
        - width: |
            [[[ return (entity.state === 'playing' || entity.state === 'paused') ? '0' : '50px'; ]]]
        - opacity: |
            [[[ return (entity.state === 'playing' || entity.state === 'paused') ? '0' : '1'; ]]]
        - transition: all 0.3s ease

  custom_fields:
    icon_right:
      card:
        type: custom:button-card
        show_icon: false
        show_entity_picture: true
        entity_picture: |
          [[[
            const s = entity?.state;
            if (s === 'playing' || s === 'paused') return null;
            return `/local/images/Homio/icons/${variables.icon}.svg`;
          ]]]
        styles:
          card: [width: 50px, height: 50px, background: none, box-shadow: none, padding: 0]
          img_cell: [width: 60%, height: 60%]
          entity_picture: [width: 100%, height: 100%]
